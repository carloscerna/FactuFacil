{# Heredando la plantilla principal #}

{% extends 'default_layout.html' %}

{% block extraCSS %}
<style>
    #lista-contenido li {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    #lista-contenido li .ruta {
        flex: 1; /* La columna de la ruta ocupa todo el espacio disponible */
        text-align: left; /* Asegura que el texto e √≠conos est√©n alineados a la izquierda */
        display: flex; /* Si los √≠conos y nombres est√°n desalineados */
        align-items: center; /* Centra verticalmente √≠conos y nombres */
        gap: 10px; /* A√±ade espacio entre √≠conos y nombres */
    }
    
    #lista-contenido li .boton {
        flex: 0; /* La columna del bot√≥n ocupa solo lo necesario */
        text-align: right;
    }
/* ESTILO DEL FLEXBOX */ 
.flex-lista {
    display: flex;
    flex-wrap: wrap; /* Permitir que los elementos pasen a la siguiente fila */
    gap: 10px; /* Espaciado entre los elementos */
    list-style-type: none;
    padding: 0;
}

.flex-lista li {
    flex: 1 1 calc(50% - 10px); /* Cada elemento ocupa el 50% menos el espacio del gap */
    background-color: #f9f9f9;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-sizing: border-box; /* Asegura que el padding no afecte el ancho */
}

/* MEJORA DE ICONOS Y BOTONES. */
.flex-lista li, .grid-lista li {
    display: flex;
    justify-content: flex-start; /* √çcono a la izquierda, bot√≥n a la derecha */
    align-items: center; /* Centrar verticalmente */
    gap: 20px;
}

.flex-lista li button, .grid-lista li button {
    margin-left: 10px; /* Espaciado del bot√≥n respecto al texto */
}
    /* ESTILO PARA LOS BOTONES */
    .btn-descargar {
        padding: 5px 10px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        margin-left: 10px;
    }
    
    .btn-descargar:hover {
        background-color: #218838;
    }
    /* ESTLO PARA LA PAGINA Y LOS ELEMENTOS*/
            body {
                font-family: Arial, sans-serif;
                margin: 0px;
            }
    
            h1 {
                text-align: center;
            }
    
            #lista-contenido {
                list-style-type: none;
                padding: 0;
            }
    
            #lista-contenido li {
                margin: 5px 0;
            }
    
            a {
                text-decoration: none;
                color: #007BFF;
                cursor: pointer;
            }
    
            a:hover {
                text-decoration: underline;
            }
    
            .navegacion {
                margin-bottom: 20px;
            }
    
            .navegacion a {
                font-weight: bold;
                color: #FF5733;
            }
            .fa-file-pdf {
                color: red;
            }
            
            .fa-file-word {
                color: blue;
            }
            
            .fa-file-excel {
                color: green;
            }
            
            .fa-file-image {
                color: orange;
            }
</style>
{% endblock %}

{% block javascripts %}
<script>
function obtenerIcono(formato) {
    switch (formato.toLowerCase()) {
        case 'pdf':
            return '<i class="fad fa-file-pdf"></i>';
            //return 'üìÑ'; // Puedes reemplazar con `<i class="fas fa-file-pdf"></i>` usando Font Awesome
        case 'doc':
        case 'docx':
            return 'üìù'; // Para documentos Word
        case 'xls':
            return '<i class="fad fa-file-excel"></i>';
        case 'xlsx':
            return '<i class="fad fa-file-excel"></i>';
            //return 'üìä'; // Para hojas de c√°lculo Excel
        case 'png':
        case 'jpg':
        case 'jpeg':
        case 'gif':
            return 'üñºÔ∏è'; // Para im√°genes
        case 'zip':
        case 'rar':
            return 'üì¶'; // Para archivos comprimidos
        default:
            return '<i class="fad fa-folder fa-lg" style="--fa-primary-color: #eefd21; --fa-secondary-color: #e5ff00;"></i>' ;
            // return 'üìÅ'; // Gen√©rico o carpetas
    }
}
</script>
<script>  
        // Variables globales para controlar la navegaci√≥n
        let historial = ["C:/TempSistemaRegistro/Carpetas"];

        // Funci√≥n para cargar el contenido de una carpeta
        function cargarContenido(ruta = "C:/TempSistemaRegistro/Carpetas") {
            $.ajax({
                url: 'php_libs/soporte/Archivos/ListarTemp.php',
                method: 'GET',
                data: { ruta: ruta },
                dataType: 'json',
                success: function(respuesta) {
                    const lista = $('#lista-contenido');
                    lista.empty(); // Limpiar la lista existente

                    if (ruta !== historial[historial.length - 1]) {
                        historial.push(ruta); // Agrega la ruta al historial si es nueva
                        console.log('Historial actualizado:', historial); // Depuraci√≥n
                    }

                    respuesta.forEach(function(elemento) {
                        if (elemento.tipo === 'Carpeta') {
                            lista.append(`<li>
                                <div class="ruta">
                                    üìÅ <a href="#" class="carpeta" data-ruta="${elemento.ruta}">${elemento.nombre}</a>
                                </div>
                                <div class="boton">
                                    <!-- Ning√∫n bot√≥n en las carpetas, pero la estructura se conserva -->
                                </div>
                            </li>`);
                        } else {
                            const icono = obtenerIcono(elemento.formato); // Obtener el √≠cono seg√∫n el formato
                            lista.append(`<li>
                                <div class="ruta">
                                    ${icono} ${elemento.nombre} (${elemento.formato.toUpperCase()})
                                </div>
                                <div class="boton">
                                    <button class="btn-descargar" data-archivo="${elemento.ruta}">Descargar</button>
                                </div>
                            </li>`);
                        }
                    });

                    // Agregar evento de clic a las carpetas
                    $('.carpeta').on('click', function(e) {
                        e.preventDefault();
                        const nuevaRuta = $(this).data('ruta');
                        cargarContenido(nuevaRuta); // Cargar la nueva carpeta
                    });
                },
                error: function() {
                    alert('Hubo un problema al cargar el contenido.');
                }
            });
        }

        $(document).ready(function() {
            // Funci√≥n para regresar a la carpeta anterior
            $('#btnAtras').on('click', function() {
                console.log('Bot√≥n atr√°s presionado'); // Depuraci√≥n
                if (historial.length > 1) {
                    historial.pop(); // Elimina la carpeta actual del historial
                    const rutaAnterior = historial[historial.length - 1]; // Obt√©n la carpeta anterior
                    cargarContenido(rutaAnterior); // Carga la carpeta anterior
                } else {
                    alert('No hay carpetas anteriores para regresar.');
                }
            });
        });
        //
        // Evento para descargar archivos
        $(document).ready(function() {
            $(document).on('click', '.btn-descargar', function(e) {
                e.preventDefault();
                const archivo = $(this).data('archivo');
                window.location.href = `php_libs/soporte/Archivos/descargar.php?archivo=${encodeURIComponent(archivo)}`;
            });
        });

    function normalizarRuta(ruta) {
        return ruta.replace(/\\/g, '/');
    }

    // Cargar la carpeta inicial al cargar la p√°gina
        $(document).ready(function() {
            cargarContenido();
        });
</script>
{% endblock %}

{% block contenidos %}
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper fondoBody">
    <!-- Content Header (Page header) 
    Se elimino content-header section solo se va dejar Main Content -->
    
  <!-- Main content -->
    <section class="content">
        <div class="container-fluid">
            <h1>Explorador de la Carpeta</h1>
            <div class="navegacion">
                <button id="btnAtras" name="btaTras" title="Atras" class="form-control">‚è™ Regresar</button>
            </div>
            
        
            <ul id="lista-contenido" class="flex-lista">
                <!-- Aqu√≠ se mostrar√°n carpetas y archivos -->
            </ul>
    
        </div>
    </section>  
</div> <!-- /.content-Wrapper, Contains page content. -->
{% endblock %}

{% block loginUser %}
<!--	{% include 'layout-login-user.html' %} -->
{% endblock %}