{# Heredando la plantilla principal #}

{% extends 'default_layout.html' %}

{% block extraCSS %}

{% endblock %}

{% block javascripts %}
    <script type="text/JavaScript" src="js/main_matricula_masiva.js"></script>
    <script type="text/JavaScript" src="js/default.js"></script>
    <script type="text/JavaScript" src="js/Estudiantes/BuscarMatriculaEstudiantes.js"></script>
 <!-- cargar datos del nombre del archivo. -->
 <script>
    $(document).ready(function() {
    
      // Función para cargar Año Lectivo
      function cargarAnnLectivo() {
        const $annLectivo = $("#lstannlectivo");
    
        $annLectivo.html('<option value="">Cargando...</option>');
    
        $.post("includes/cargar-ann-lectivo.php", function(data) {
          $annLectivo.empty().append('<option value="">Seleccionar...</option>');
          $.each(data, function(i, item) {
            $annLectivo.append(`<option value="${item.codigo}">${item.nombre}</option>`);
          });
        }, "json");
      }
    
      // Función para cargar Modalidad basado en Año Lectivo
      function cargarModalidad(annlectivo) {
        const $modalidad = $("#lstmodalidad");
    
        $modalidad.html('<option value="">Cargando...</option>');
    
        $.post("includes/cargar-bachillerato.php", { annlectivo: annlectivo }, function(data) {
          $modalidad.empty().append('<option value="">Seleccionar...</option>');
          $.each(data, function(i, item) {
            $modalidad.append(`<option value="${item.codigo}">${item.descripcion}</option>`);
          });
        }, "json");
      }
    
      // Función para cargar Grado - Sección - Turno basado en Modalidad
      function cargarGradoSeccion(modalidad, annlectivo) {
        const $gradoSeccion = $("#lstgradoseccion");
    
        $gradoSeccion.html('<option value="">Cargando...</option>');
    
        $.post("includes/cargar-grado-seccion.php", { elegido: modalidad, ann: annlectivo }, function(data) {
          $gradoSeccion.empty().append('<option value="">Seleccionar...</option>');
          $.each(data, function(i, item) {
            $gradoSeccion.append(`<option value="${item.codigo_grado}${item.codigo_seccion}${item.codigo_turno}">
              ${item.descripcion_grado} ${item.descripcion_seccion} - ${item.descripcion_turno}
            </option>`);
          });
        }, "json");
      }
    
      // Cargar Año Lectivo al cargar la página
      cargarAnnLectivo();
    
      // Evento: cambiar Año Lectivo -> cargar Modalidades
      $("#lstannlectivo").change(function() {
        const annlectivo = $(this).val();
        if (annlectivo) {
          cargarModalidad(annlectivo);
          $("#lstgradoseccion").empty().append('<option value="">Seleccionar...</option>'); // Resetea grado-sección
        } else {
          $("#lstmodalidad, #lstgradoseccion").empty().append('<option value="">Seleccionar...</option>');
        }
      });
    
      // Evento: cambiar Modalidad -> cargar Grado/Sección/Turno
      $("#lstmodalidad").change(function() {
        const modalidad = $(this).val();
        const annlectivo = $("#lstannlectivo").val();
        if (modalidad && annlectivo) {
          cargarGradoSeccion(modalidad, annlectivo);
        } else {
          $("#lstgradoseccion").empty().append('<option value="">Seleccionar...</option>');
        }
      });
    
    });
    </script>
{% endblock %}

{% block contenidos %}
 <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">

<!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        
        <div class="row" id="Origen">
            <div class="col-md-8 mx-auto">
              <div class="card card-primary">
                <div class="card-header d-flex justify-content-between align-items-center">
                  <h3 class="card-title mb-0">Seleccione</h3>
                  <button type="button" class="btn btn-success btn-md" id="goMatriculaImportar" data-toggle="tooltip" data-placement="top" title="Importar Matrícula">
                    <span class="fas fa-file-upload"></span>
                  </button>
                </div>
          
                <form action="" method="post" name="form" id="form" class="form-horizontal">
                  <div class="card-body">
                    <input type="hidden" id="accion_buscar" name="accion_buscar" value="BuscarLista">
          
                    <!-- Año Lectivo -->
                    <div class="form-group row">
                      <label for="lstannlectivo" class="col-sm-4 col-form-label">Año Lectivo</label>
                      <div class="col-sm-8">
                        <select id="lstannlectivo" name="lstannlectivo" class="custom-select" required></select>
                      </div>
                    </div>
          
                    <!-- Modalidad -->
                    <div class="form-group row">
                      <label for="lstmodalidad" class="col-sm-4 col-form-label">Modalidad</label>
                      <div class="col-sm-8">
                        <select id="lstmodalidad" name="lstmodalidad" class="custom-select"></select>
                      </div>
                    </div>
          
                    <!-- Grado, Sección y Turno -->
                    <div class="form-group row">
                      <label for="lstgradoseccion" class="col-sm-4 col-form-label">Grado - Sección - Turno</label>
                      <div class="col-sm-8">
                        <select id="lstgradoseccion" name="lstgradoseccion" class="custom-select"></select>
                      </div>
                    </div>
                  </div>
          
                  <div class="card-footer d-flex justify-content-center">
                    <button type="submit" class="btn btn-primary mr-2" id="goBuscar" title="Buscar">
                      <span class="fas fa-search"></span> Buscar
                    </button>
                    <button type="button" class="btn btn-danger" id="goCancelar" title="Cancelar">
                      <span class="fas fa-window-close"></span> Cancelar
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          

          <div class="row" id="Resultados" style="display: none;">
            <div class="col">
              <div class="card card-info mx-auto">
                <div class="card-header">
                  <h3 class="card-title">Listado de Alumnos</h3>
                </div>
                <div class="card-body">
                  <table id="tablaAlumnos" class="table table-bordered table-striped" style="width:100%">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>ID Alumno</th>
                        <th>NIE</th>
                        <th>Nombre Completo</th>
                        <th>Seleccionar</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>        
          </div>  
    </section>
  </div> <!-- /.Content Wrapper. Caontains page content -->			
{% endblock %}

{% block menu %}
<!-- plantilla que contiene el menú principal. -->
		{% include 'layout-menu.html' %}
{% endblock %}

{% block loginUser %}
<!--	{% include 'layout-login-user.html' %} -->
{% endblock %}