{% extends 'default_layout.html' %}

{% block extraCSS %}
{% endblock %}

{% block javascripts %}
<script type="text/JavaScript" src="js/main_matricula_masiva.js"></script>
<script type="text/JavaScript" src="js/default.js"></script>
<script type="text/JavaScript" src="js/Estudiantes/BuscarMatriculaEstudiantes.js"></script>
<!-- cargar datos del nombre del archivo. -->
<script>
  $(document).ready(function() {
  
    // Función para cargar Año Lectivo
    function cargarAnnLectivo() {
      const $annLectivo = $("#lstannlectivo");
  
      $annLectivo.html('<option value="">Cargando...</option>');
  
      $.post("includes/cargar-ann-lectivo.php", function(data) {
        $annLectivo.empty().append('<option value="">Seleccionar...</option>');
        $.each(data, function(i, item) {
          $annLectivo.append(`<option value="${item.codigo}">${item.nombre}</option>`);
        });
      }, "json");
    }
  
    // Función para cargar Modalidad basado en Año Lectivo
    function cargarModalidad(annlectivo) {
      const $modalidad = $("#lstmodalidad");
  
      $modalidad.html('<option value="">Cargando...</option>');
  
      $.post("includes/cargar-bachillerato.php", { annlectivo: annlectivo }, function(data) {
        $modalidad.empty().append('<option value="">Seleccionar...</option>');
        $.each(data, function(i, item) {
          $modalidad.append(`<option value="${item.codigo}">${item.descripcion}</option>`);
        });
      }, "json");
    }
  
    // Función para cargar Grado - Sección - Turno basado en Modalidad
    function cargarGradoSeccion(modalidad, annlectivo) {
      const $gradoSeccion = $("#lstgradoseccion");
  
      $gradoSeccion.html('<option value="">Cargando...</option>');
  
      $.post("includes/cargar-grado-seccion.php", { elegido: modalidad, ann: annlectivo }, function(data) {
        $gradoSeccion.empty().append('<option value="">Seleccionar...</option>');
        $.each(data, function(i, item) {
          $gradoSeccion.append(`<option value="${item.codigo_grado}${item.codigo_seccion}${item.codigo_turno}">
            ${item.descripcion_grado} ${item.descripcion_seccion} - ${item.descripcion_turno}
          </option>`);
        });
      }, "json");
    }
  
    // Cargar Año Lectivo al cargar la página
    cargarAnnLectivo();
  
    // Evento: cambiar Año Lectivo -> cargar Modalidades
    $("#lstannlectivo").change(function() {
      const annlectivo = $(this).val();
      if (annlectivo) {
        cargarModalidad(annlectivo);
        $("#lstgradoseccion").empty().append('<option value="">Seleccionar...</option>'); // Resetea grado-sección
      } else {
        $("#lstmodalidad, #lstgradoseccion").empty().append('<option value="">Seleccionar...</option>');
      }
    });
  
    // Evento: cambiar Modalidad -> cargar Grado/Sección/Turno
    $("#lstmodalidad").change(function() {
      const modalidad = $(this).val();
      const annlectivo = $("#lstannlectivo").val();
      if (modalidad && annlectivo) {
        cargarGradoSeccion(modalidad, annlectivo);
      } else {
        $("#lstgradoseccion").empty().append('<option value="">Seleccionar...</option>');
      }
    });
  
  });
  </script>
{% endblock %}

{% block contenidos %}
<div class="content-wrapper">
  <section class="content">
    <div class="container-fluid">

      <!-- Formulario Origen -->
      <div class="row" id="Origen">
        <div class="col-md-8 mx-auto">
          <div class="card card-primary">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h3 class="card-title mb-0">Seleccione</h3>
              <button type="button" class="btn btn-success btn-md" id="goMatriculaImportar" title="Importar Matrícula">
                <span class="fas fa-file-upload"></span>
              </button>
            </div>

            <form id="form" class="form-horizontal">
              <div class="card-body">
                <input type="hidden" id="accion_buscar" name="accion_buscar" value="BuscarLista">

                <div class="form-group row">
                  <label for="lstannlectivo" class="col-sm-4 col-form-label">Año Lectivo</label>
                  <div class="col-sm-8">
                    <select id="lstannlectivo" name="lstannlectivo" class="custom-select" required></select>
                  </div>
                </div>

                <div class="form-group row">
                  <label for="lstmodalidad" class="col-sm-4 col-form-label">Modalidad</label>
                  <div class="col-sm-8">
                    <select id="lstmodalidad" name="lstmodalidad" class="custom-select"></select>
                  </div>
                </div>

                <div class="form-group row">
                  <label for="lstgradoseccion" class="col-sm-4 col-form-label">Grado - Sección - Turno</label>
                  <div class="col-sm-8">
                    <select id="lstgradoseccion" name="lstgradoseccion" class="custom-select"></select>
                  </div>
                </div>
              </div>

              <div class="card-footer d-flex justify-content-center">
                <button type="submit" class="btn btn-primary mr-2" id="goBuscar">
                  <span class="fas fa-search"></span> Buscar
                </button>
                <button type="button" class="btn btn-danger" id="goCancelar">
                  <span class="fas fa-window-close"></span> Cancelar
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Formulario Destino -->
      <div class="row" id="Destino" style="display: none;">
        <div class="col-md-8 mx-auto">
          <div class="card card-success">
            <div class="card-header">
              <h3 class="card-title mb-0">Destino de la Matrícula</h3>
            </div>

            <form id="formDestino" class="form-horizontal">
              <div class="card-body">
                <div class="form-group row">
                  <label for="lstannlectivoD" class="col-sm-4 col-form-label">Año Lectivo Destino</label>
                  <div class="col-sm-8">
                    <select id="lstannlectivoD" name="lstannlectivoD" class="custom-select" required></select>
                  </div>
                </div>

                <div class="form-group row">
                  <label for="lstmodalidadD" class="col-sm-4 col-form-label">Modalidad Destino</label>
                  <div class="col-sm-8">
                    <select id="lstmodalidadD" name="lstmodalidadD" class="custom-select" required></select>
                  </div>
                </div>

                <div class="form-group row">
                  <label for="lstgradoseccionD" class="col-sm-4 col-form-label">Grado - Sección - Turno Destino</label>
                  <div class="col-sm-8">
                    <select id="lstgradoseccionD" name="lstgradoseccionD" class="custom-select" required></select>
                  </div>
                </div>
              </div>

              <div class="card-footer d-flex justify-content-center">
                <button type="button" class="btn btn-success" id="goCrearMatricula">
                  <span class="fas fa-save"></span> Guardar Matrícula
                </button>
              </div>
            </form>

          </div>
        </div>
      </div>

      <!-- Resultados -->
      <div class="row" id="Resultados" style="display: none;">
        <div class="col">
          <div class="card card-info mx-auto">
            <div class="card-header">
              <h3 class="card-title">Listado de Alumnos</h3>
            </div>
            <div class="card-body">
              <table id="tablaAlumnos" class="table table-bordered table-striped" style="width:100%">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>ID Alumno</th>
                    <th>NIE</th>
                    <th>Nombre Completo</th>
                    <th><input type="checkbox" id="selectAllAlumnos"></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
{% endblock %}

{% block menu %}
{% include 'layout-menu.html' %}
{% endblock %}

{% block loginUser %}
{% endblock %}
